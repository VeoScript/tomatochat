// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model Account {
  id                              String                @id @default(cuid())
  userId                          String
  type                            String
  provider                        String
  providerAccountId               String
  refresh_token                   String?               @db.Text
  access_token                    String?               @db.Text
  expires_at                      Int?
  token_type                      String?
  scope                           String?
  id_token                        String?               @db.Text
  session_state                   String?
  oauth_token_secret              String?
  oauth_token                     String?
  user                            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id                              String                @id @default(cuid())
  sessionToken                    String                @unique
  userId                          String
  expires                         DateTime
  user                            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
}

model User {
  id                              String                @id @default(cuid())
  name                            String?
  username                        String?
  location                        String?
  email                           String?               @unique
  emailVerified                   DateTime?
  image                           String?
  accounts                        Account[]
  sessions                        Session[]
  rooms                           Room[]
  chats                           Chat[]
  joinedrooms                     JoinedRoom[]
}

model VerificationToken {
  identifier                      String
  token                           String                @unique
  expires                         DateTime

  @@unique([identifier, token])
}

model Room {
  id                              String                @id @default(cuid())
  index                           Int                   @unique @default(autoincrement())
  photo                           String?
  name                            String                @unique
  slug                            String                @unique
  privacy                         String
  description                     String                @db.Text
  password                        String?
  date                            String
  joinedroom                      JoinedRoom[]
  chats                           Chat[]
  user                            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                          String
  
  @@index([userId])
}

model JoinedRoom {
  id                              String                @id @default(cuid())
  index                           Int                   @unique @default(autoincrement())
  indicator                       Boolean               @default(true)
  role                            Role                  @default(USER)
  date                            String
  seen                            Boolean               @default(false)
  lastChat                        String?               @db.LongText
  lastChatType                    ChatType              @default(NORMAL)
  lastSentUserId                  String?
  lastSentUserImage               String?
  lastSentUserName                String?
  lastSentDate                    String?
  room                            Room                  @relation(fields: [roomSlug], references: [slug], onDelete: Cascade)
  roomSlug                        String
  user                            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                          String
  
  @@index([roomSlug, userId])
}

model Chat {
  id                              String                @id @default(cuid())
  index                           Int                   @unique @default(autoincrement())
  chattype                        ChatType              @default(NORMAL)
  message                         String                @db.LongText
  date                            String
  room                            Room                  @relation(fields: [roomSlug], references: [slug], onDelete: Cascade)
  roomSlug                        String
  user                            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                          String
  
  @@index([roomSlug, userId])
}

enum Role {
  USER
  ADMIN
}

enum ChatType {
  NORMAL
  JOIN
}